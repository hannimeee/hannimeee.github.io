<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@200..900&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Locked In</title>
  <link rel="stylesheet" href="navBar.css">
  <link rel="stylesheet" href="universalStyles.css">
  <link rel="stylesheet" href="gradientbackGround.css">
  <link rel="stylesheet" href="buttons.css">
</head>
<body>
  <div class="navbarFlexboxLEFT">
    <div class="navbarButtons"><a href="homePage.html">Home Page</a></div>
    <div style="flex: 1; justify-content: flex-end">
      <div class="navbarFlexboxRIGHT">
        <div class="navbarButtons"><a href="written_works_page.html">Workflow</a></div>
        <div class="navbarButtons"><a href="settings_page.html">Settings</a></div>
        <div class="navbarButtons"><a href="recorder.html">Camera View</a></div>
        <div class="navbarButtons"><a href="graph.html">Graph View</a></div>
      </div>
    </div>
  </div>

<button id="startButton" class="navbarButtons">Start Recording</button>
<button id="stopButton" disabled class="navbarButtons">Stop Recording</button>
<video id="video" width="640" height="480" autoplay muted></video>
<video id="recordedVideo" width="640" height="480" controls></video>

<script>
  const startButton = document.getElementById('startButton');
  const stopButton = document.getElementById('stopButton');
  const video = document.getElementById('video');
  const recordedVideo = document.getElementById('recordedVideo');
  let mediaRecorder;
  let recordedBlobs;

  startButton.addEventListener('click', async () => {
    const stream = await navigator.mediaDevices.getUserMedia({video: true});
    video.srcObject = stream;

    // Specify MIME type for H.264 encoding if supported
    const options = MediaRecorder.isTypeSupported('video/mp4; codecs="avc1.42E01E"')
                    ? { mimeType: 'video/mp4; codecs="avc1.42E01E"' }
                    : { mimeType: 'video/webm' }; // Fallback to WebM if H.264 is not supported

    mediaRecorder = new MediaRecorder(stream, options);
    recordedBlobs = [];
    mediaRecorder.ondataavailable = (event) => {
      if (event.data && event.data.size > 0) {
        recordedBlobs.push(event.data);
      }
    };
    mediaRecorder.start(10); // timeslice argument can be used to control the frequency of the 'dataavailable' event for long recordings
    console.log('MediaRecorder started', mediaRecorder);
    startButton.disabled = true;
    stopButton.disabled = false;
  });

  stopButton.addEventListener('click', () => {
    mediaRecorder.stop();
    video.srcObject.getTracks().forEach(track => track.stop()); // Stop video stream
    // Update the MIME type for the blob based on the actual recording settings
    const blob = new Blob(recordedBlobs, {type: mediaRecorder.mimeType});
    recordedVideo.src = URL.createObjectURL(blob);
    startButton.disabled = false;
    stopButton.disabled = true;
  });
</script>

</body>
</html>
